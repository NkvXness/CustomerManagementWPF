<Window x:Class="CustomerManagement.WPF.Views.AddPurchaseWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:CustomerManagement.WPF.Converters"
        Title="Добавить покупку" 
        Height="670" 
        Width="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Icon="/Assets/CustomerManager.ico">

    <Window.Resources>
        <converters:CurrencyConverter x:Key="CurrencyConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок -->
        <TextBlock Grid.Row="0" 
                   Text="Новая покупка"
                   FontSize="20"
                   FontWeight="Bold"
                   Margin="0,0,0,20"/>

        <!-- Информация о покупателе -->
        <Border Grid.Row="1" 
                Background="#F0F0F0" 
                Padding="10" 
                CornerRadius="5"
                Margin="0,0,0,15">
            <StackPanel>
                <TextBlock Text="Покупатель:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                <TextBlock x:Name="CustomerNameText" FontSize="16" Margin="0,0,0,5"/>
                <TextBlock x:Name="CustomerTypeText" FontSize="12" Foreground="Gray"/>
            </StackPanel>
        </Border>

        <!-- Добавление товара -->
        <GroupBox Grid.Row="2" Header="Добавить товар" Margin="0,0,0,15" Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="10"/>
                    <ColumnDefinition Width="100"/>
                </Grid.ColumnDefinitions>

                <!-- Название товара -->
                <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,0,0,10">
                    <TextBlock Text="Название товара:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox x:Name="ProductNameTextBox" Height="30" FontSize="14"/>
                </StackPanel>

                <!-- Количество -->
                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,0,10">
                    <TextBlock Text="Количество:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox x:Name="QuantityTextBox" 
                             Height="30" 
                             FontSize="14"
                             Text="1"/>
                </StackPanel>

                <!-- Цена -->
                <StackPanel Grid.Row="1" Grid.Column="2" Margin="0,0,0,10">
                    <TextBlock Text="Цена:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                    <TextBox x:Name="PriceTextBox" 
                             Height="30" 
                             FontSize="14"
                             Text="0"/>
                </StackPanel>

                <!-- Кнопка добавить -->
                <Button Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3"
                        Content="➕ Добавить в список"
                        Height="35"
                        Click="AddItemButton_Click"/>
            </Grid>
        </GroupBox>

        <!-- Список товаров -->
        <GroupBox Grid.Row="3" Header="Товары в покупке" Margin="0,0,0,15">
            <DataGrid x:Name="ItemsDataGrid"
          AutoGenerateColumns="False"
          IsReadOnly="True"
          CanUserAddRows="False"
          Height="150">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Товар" Binding="{Binding ProductName}" Width="*"/>
                    <DataGridTextColumn Header="Кол-во" Binding="{Binding Quantity}" Width="70"/>
                    <DataGridTextColumn Header="Цена" Binding="{Binding Price, Converter={StaticResource CurrencyConverter}}" Width="100"/>
                    <DataGridTextColumn Header="Сумма" Binding="{Binding TotalPrice, Converter={StaticResource CurrencyConverter}}" Width="100"/>
                    <DataGridTemplateColumn Width="40">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="🗑" 
                            Width="30" 
                            Height="25"
                            Click="RemoveItemButton_Click"
                            ToolTip="Удалить"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- Итоговая информация -->
        <Border Grid.Row="4" 
                Background="#E8F5E9" 
                Padding="15" 
                CornerRadius="5"
                Margin="0,0,0,15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Text="Сумма без скидки:" FontWeight="SemiBold"/>
                <TextBlock Grid.Row="0" Grid.Column="1" x:Name="TotalBeforeDiscountText" Text="0,00 BYN" FontSize="14"/>

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Скидка:" FontWeight="SemiBold" Margin="0,5,0,0"/>
                <TextBlock Grid.Row="1" Grid.Column="1" x:Name="DiscountText" Text="0%" FontSize="14" Foreground="Orange" Margin="0,5,0,0"/>

                <TextBlock Grid.Row="2" Grid.Column="0" Text="Сумма скидки:" FontWeight="SemiBold" Margin="0,5,0,0"/>
                <TextBlock Grid.Row="2" Grid.Column="1" x:Name="DiscountAmountText" Text="0,00 BYN" FontSize="14" Foreground="Red" Margin="0,5,0,0"/>

                <Separator Grid.Row="3" Grid.ColumnSpan="2" Margin="0,10,0,10"/>

                <TextBlock Grid.Row="3" Grid.Column="0" Text="ИТОГО К ОПЛАТЕ:" FontWeight="Bold" FontSize="16" VerticalAlignment="Bottom"/>
                <TextBlock Grid.Row="3" Grid.Column="1" x:Name="FinalAmountText" Text="0,00 BYN" FontSize="20" FontWeight="Bold" Foreground="Green" VerticalAlignment="Bottom"/>
            </Grid>
        </Border>

        <!-- Сообщение об ошибке -->
        <TextBlock Grid.Row="5"
                   x:Name="ErrorMessageTextBlock"
                   Text=""
                   Foreground="Red"
                   FontSize="12"
                   TextWrapping="Wrap"
                   Margin="0,0,0,10"
                   Visibility="Collapsed"/>

        <!-- Кнопки -->
        <StackPanel Grid.Row="6" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right">
            <Button Content="💳 Сохранить покупку"
                    x:Name="SaveButton"
                    Width="160"
                    Height="35"
                    FontSize="14"
                    IsDefault="True"
                    Margin="0,0,10,0"
                    Click="SaveButton_Click"/>

            <Button Content="Отмена"
                    Width="100"
                    Height="35"
                    FontSize="14"
                    IsCancel="True"
                    Click="CancelButton_Click"/>
        </StackPanel>
    </Grid>
</Window>